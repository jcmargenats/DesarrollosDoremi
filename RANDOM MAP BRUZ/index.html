<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Random destination</title>
  <meta name="description" content="Hand pick destinations in Google Maps">
  <meta name="author" content="Bruno Margenats">

  <link rel="stylesheet" href="styles.css">

  <!-- Version 0.1 -->
</head>


<body>


<div id="site">
  <div class="google-maps">
  <iframe id="mapHolder" src="" frameborder="0" aria-hidden="false" tabindex="0"></iframe>
  <button id="btnShowmap" type="button" />START</button>
  </div>

  <div id="nav">
    <button id="btnReloadmap" onclick="showMap()" type="button" />Reload</button>
    <button id="btnFullscreen" type="button">Fullscreen</button>
    <button id="btnInfo" type="button">Info</button>
  </div>
</div>


<script>

  /* We need a function to shuffle the json list*/
 function shuffle(o){
    for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
};

/* Set our firs item on the list*/
var indexjson = 0;

/* Function to reset it if needed*/
function resetIndex(){
  indexjson = 0;
}

/*create obj variable*/
var obj;

/*fetch json*/
fetch('places.json')
  .then(res => {
    if (!res.ok) {
           throw new Error("HTTP error " + res.status);
    }
    return res.json();
  })
  .then(data => obj = data)
  .catch(err => {
    this.dataError = true;
  })
 // .then(() => console.log(obj))
 // .then(() => console.log(Object.values(obj).length)) how many items
  .then(() => totalitems = Object.values(obj).length)
  .then(() => values = shuffle(Object.values(obj))); //shuffle json list using our random function





async function showMap(randomValue){
 console.log(indexjson);
  console.log(totalitems);
 if (indexjson > (totalitems - 1)) {
  resetIndex();
  console.log(indexjson);
   }

  var randomValue = values[parseInt(indexjson)]
  console.log(randomValue); //show current map src
  var source= 'https://www.google.com/maps/embed?pb=' + randomValue + '&z=12';
  var map=document.getElementById("mapHolder");
  var clone=map.cloneNode(true);
  clone.setAttribute('src',source);
  map.parentNode.replaceChild(clone,map)

  indexjson++
}



/*Fullscreen*/
function toggleFullscreen(elem) {
  elem = elem || document.documentElement;
  if (!document.fullscreenElement && !document.mozFullScreenElement &&
    !document.webkitFullscreenElement && !document.msFullscreenElement) {
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.msRequestFullscreen) {
      elem.msRequestFullscreen();
    } else if (elem.mozRequestFullScreen) {
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) {
      elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
    }
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    }
  }
}

document.getElementById('btnFullscreen').addEventListener('click', function() {
  toggleFullscreen();
});


var btnShowmap = document.getElementById('btnShowmap');

btnShowmap.addEventListener('click', function() {
  showMap();
  btnShowmap.remove();
  document.getElementById('btnReloadmap').classList.toggle("show");
});




/* TO DO: 
- Show start button only when all the json list is loaded. Maybe a londing effect will be good.
- add grab pointer 
- Add play/stop button. 
BUGS:
Google maps zoom by default can't be customized. 
webgl context bug in firefox. works well in chrome
maybe add a timer for reload?
*/

</script>

</body>
</html>